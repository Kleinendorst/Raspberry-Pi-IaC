---
- name: Create a volume
  become: true
  community.docker.docker_volume:
    name: memos_data
- name: Install the container
  become: true
  community.docker.docker_container:
    name: memos-server
    image: "neosmemo/memos:stable"
    image_name_mismatch: recreate
    # command:
    #   - '--driver'
    #   - 'postgres'
    #   - '--dsn'
    #   - 'postgresql://postgres:PASSWORD@localhost:5432/memos'
    env:
      MEMOS_DRIVER: 'postgres'
      MEMOS_DSN: "postgresql://{{ memos_postgres_user }}:{{ memos_postgres_password }}@postgres.kleinendorst.info:5432/memos"
    ports:
      - "127.0.0.1:5230:5230/tcp"
    mounts:
      - source: memos_data
        target: /var/opt/memos
    restart_policy: always
